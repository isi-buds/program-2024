---
title: "Day 6 Lab: Linear Regression Solutions"
format: 
  html:
    toc: true
    toc-expand: true
    toc-depth: 2
editor: visual
execute:
  echo: fenced
theme: cerulean
---

# Simple linear regression

Statins are a class of drugs widely used to lower cholesterol.
There are two main types of cholesterol: low density lipoprotein (LDL) and high density lipoprotein (HDL).
Research suggests that adults with elevated LDL may be at risk for adverse cardiovascular events such as a heart attack or stroke.
In 2013, a panel of experts commissioned by the American College of Cardiology and the American Heart Association recommended that statin therapy be considered in individuals who either have any form of atherosclerotic cardiovascular disease or have LDL cholesterol levels ≥ 190 mg/dL, individuals with Type II diabetes ages 40 to 75 with LDL between 70 to 189 mg/dL, and non-diabetic individuals ages of 40 to 75 with a predicted probability of future clogged arteries of at least 0.075.

Health policy analysts have estimated that if the new guidelines were to be followed, almost half of Americans ages 40 to 75 and nearly all men over 60 would be prescribed a statin.
However, some physicians have raised the question of whether treatment with a statin might be associated with an increased risk of cognitive decline.
Older adults are at increased risk for cardiovascular disease, but also for cognitive decline.
A study by [Joosten, et al.](https://www.ahajournals.org/doi/10.1161/STROKEAHA.111.000496) examined the association of statin use and other variables with cognitive ability in an observational cohort of 4,095 participants from the Netherlands who were part of the larger PREVEND study.
We will focus on a random sample of 500 participants from the cohort.

## Question 1

Read in an examine the data (e.g. use `glimpse()`, `head()`, `summary()`, etc.).

Cognitive function is measured via the Ruff Figural Fluency Test (RFFT).
The RFFT is one measure of cognitive function that provides information about cognitive abilities such as planning and the ability to switch between different tasks.
Scores range from 0 (worst) to 175 (best)

## Question 1 Solution

```{r}
library(tidyverse)

prevend_data <- read_csv("prevend.samp.csv")

glimpse(prevend_data)
```

## Question 2

Plot cognitive function by age.
What relationship do you observe, if any?

## Question 2 Solution

```{r}
ggplot(prevend_data, aes(x = Age, y = RFFT)) +
  geom_point() +
  theme_bw()
```

There appears to be a negative linear relationship between cognitive function and age.

## Question 3

Let's begin by fitting a simple linear model of RFFT regressed on age.
Fit the model and write out the estimated linear model.

## Question 3 Solution

```{r}
model1 <- lm(RFFT ~ Age, data = prevend_data)

model1_intercept <- summary(model1)$coefficients["(Intercept)", ]
model1_slope <- summary(model1)$coefficients["Age", ]
```

The estimated model is $$\hat{RFFT} = 137.55 - 1.26 Age$$.

## Question 4

Interpret $\hat{\beta_0}$ and $\hat{\beta_1}$ in context from this model.
Do they make sense?

## Question 4 Solution

We estimate an RFFT score of `r as.numeric(model1_intercept["Estimate"])` for someone of Age 0.
The intercept does not make sense in this context.
*Note the inline R code used to answer this question.*

We estimate a decrease of `r as.numeric(model1_slope["Age"])` associated with a difference of one more year of age.
This seems reasonable judging from our plot.

## Question 5

Reproduce the plot from question 2 with the regression line added to the plot.

## Question 5 Solution

There are different ways to do this.
I chose to manually specify the coefficients we got from question 3.

```{r}
ggplot(prevend_data, aes(x = Age, y = RFFT)) +
  geom_point() +
  theme_bw() +
  geom_abline(
    intercept = as.numeric(model1$coefficients["(Intercept)"]),
    slope  = as.numeric(model1$coefficients["Age"]), 
    color = "blue"
  )
```

# Linear regression

## Question 6

In this investigation we want to understand the relationship between statin and cognitive function, specifically RFFT.
Let's now fit the model of RFFT regressed on statin.
Fit the model and write out the estimate regression equation.
Interpret each coefficient in context.

## Question 6 Solution

```{r}
model2 <- lm(RFFT ~ Statin, data = prevend_data)

summary(model2)
```

Our estimated model is $$\hat{RFFT} = 70.71 - 10.05 \times Statin.$$

We estimate an RFFT score of `r as.numeric(model2$coefficients["(Intercept)"])` for someone not receiving statin therapy. We estimate statin users to have an RFFT score `r abs(as.numeric(model2$coefficients["Statin"]))` lower than that of a non statin user, on average.

## Question 7

The investigators behind the Joosten study anticipated an issue in the analysis—statins are used more often in older adults than younger adults, and older adults suffer a natural cognitive decline.
Age is a potential confounder in this setting.
If age is not accounted for in the analysis, it may seem that cognitive decline is more common among individuals prescribed statins, simply because those prescribed statins are simply older and more likely to have reduced cognitive ability than those not prescribed statins.

We want to examine the relationship between statin use and cognitive function, controlling for age.
Fit the appropriate regression and interpret the coefficient of statin in context.

## Question 7 Solution

```{r}
model3 <- lm(RFFT ~ Statin + Age, data = prevend_data)

summary(model3)
```

We estimate statin users to have an RFFT score `r abs(as.numeric(model3$coefficients["Statin"]))` higher than that of a non statin user, on average for people of the same age.

## Question 8

We are learning to be responsible statisticians so we need to provide some measure of uncertainty for our estimates.
In a real setting 95% confidence intervals would be reported, often in parentheses, with our reported estimate.

-   Compute 95% confidence intervals for the coefficient of statin for the models with and without age.
-   If they differ, is one of the confidence intervals wrong?

## Question 8 Solution

```{r}
model_without_age <- summary(model2)$coefficients["Statin", ]

(model2_95_ci <- model_without_age["Estimate"] + c(-1, 1) * qnorm(1 - 0.05 / 2) * model_without_age["Std. Error"])

model_with_age <- summary(model3)$coefficients["Statin", ]

(model3_95_ci <- model_with_age["Estimate"] + c(-1, 1) * qnorm(1 - 0.05 / 2) * model_with_age["Std. Error"])
```

The 95% confidence interval for difference in RFFT for statin users compared to non statin users is (`r round(model2_95_ci, 2)[1]`, `r round(model2_95_ci, 2)[2]`), and controlling for age it's (`r round(model3_95_ci, 2)[1]`, `r round(model3_95_ci, 2)[2]`).
Neither interval is "wrong", they just correspond to different values, so it just depends on what we care about.
We wanted to investigate the true relationship between cognition and statin use, but age confounds this relationship so we do want to control for it.

## Question 9

What if we were now interested in the relationship between cognitive function and age, and we suspect that this relationship would differ for those using statin and those not.

-   Fit the appropriate model for this (i.e. we want to allow for different slopes from age for non statin and statin users).
-   Did you find evidence of a different slope for age based on statin usage?
-   Plot the resulting regression lines for non statin and statin users, with 95% credible intervals, over the plot from question 2.

## Question 9 Solutions

```{r}
model4 <- lm(RFFT ~ Age + Statin + Age * Statin, data = prevend_data)

int_sum <- summary(model4)$coefficient["Age:Statin", ]

model_4_96_ci <- int_sum["Estimate"] + c(-1, 1) * qnorm(1 - 0.05 / 2) * int_sum["Std. Error"]
```

We estimate the interaction coefficient to be between `r round(model_4_96_ci[1], 2)` and `r round(model_4_96_ci[2], 2)`, with 95% confidence, therefore we did not find evidence of a different slope for age based on statin usage.
This is also visualizually evident in the following plot.

```{r}
ggplot(
  data = prevend_data, 
  aes(x = Age, y = RFFT, color = Gender)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```
